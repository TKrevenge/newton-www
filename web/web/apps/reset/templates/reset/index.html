{% extends "base.html" %}
{% load i18n %}
{% load utils %}

{% block title %}
{% trans "Repassword" %}
{% endblock %}

{% block content %}
<section id="register" class="section-list">
		<div class="page-title">
			<div class="container">
				<p>{% trans "Repassword" %}</p>
			</div>
		</div>
        <div class="raw">
            <div class="col-md-4 col-lg-4 col-sm-4 col-xs-0"></div>
            <div id="dialog" class="col-md-4 col-lg-4 col-sm-4 col-xs-12">
        
            </div>  
            <div class="col-md-4 col-lg-4 col-sm-4 col-xs-0"></div>
        </div>
        
        <div class="text-center" style="padding: 30px;">
            <form>
                {% csrf_token %}
                <input class="email_add" type="text" value="weixuefeng@lubangame.com"><br/>
                <a class="subscription-button">{% trans "Repassword" %}</a>
            </form>
        </div>
    </div>
</section>

<section id="reset" class="section-list">
	<div class="reset-title container text-center">
		<h2>{% trans "Reset" %}</h2>
	</div>
	<div class="container">
		<form class="form" action="/reset/post_email/" method="POST">
			{% csrf_token %}
			{% include "form.html" %}
			<div class="raw">
				<div class="col-lg-5 col-sm-5 col-xs-5"></div>
				<div>
					<button class="form-button" type="submit">{% trans "Reset" %}</button>
				</div>
			</div>
		</form>
	</div>
</section>

{% endblock %}
{% block js %}
<script>

// subscribe email list
var FAIL = 0
var SUCCESS = 1
var UNAUTH = 2
var SIGN_ERROR = 3
var INVALID_PARAMS = 4
var MAINTAIN = 5
var UPGRADE = 6
var emailReg = new RegExp("^[a-zA-Z0-9_.-]+@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*\.[a-zA-Z0-9]{2,6}$");

$(".subscription-button").click(function () {
	if ($(".subscription-height")[0]) {
		return;
	}
	var email_address = $("input[type='text']").val();
	var email_address = $("input[type='text']").val();
	var content = "邮件已经发送到您的邮箱" + email_address + ",请查收";
	var alertType = "alert-success";
	showSubscriptionResult(content, alertType);
	// if(email_address.length > 0){
	// 	if(emailReg.test(email_address)){
	// 		$.post("/reset/", { "email": email_address }, function (ret) {
	// 			if (ret.error_code === FAIL) {
	// 				var content = ret.error_message;
	// 				var alertType = "alert-danger";
	// 				showSubscriptionResult(content, alertType);
	// 			} else {
	// 				if (ret.result) {
	// 					var content = ret.result.msg;
	// 					var alertType = "alert-success";
	// 					showSubscriptionResult(content, alertType);
	// 				}else{
    //                     var content = "{% trans 'Subscribed Failed!' %}";
    //                     var alertType = "alert-danger";
    //                     showSubscriptionResult(content, alertType);
    //                 }
	// 			}
	// 		});
	// 	}else{
	// 		var content = "{% trans 'Invalid Email Address!' %}";
	// 		var alertType = "alert-danger";
	// 		showSubscriptionResult(content, alertType);
	// 	}
	// }else{
	// 	var content = "{% trans 'Please Input Email Address!' %}";
	// 	var alertType = "alert-danger";
	// 	showSubscriptionResult(content, alertType);
	// }
})

/**
 * Show the subscription's result with parameters.
 * 
 * @param content { String } alert content for show in page
 * @param alertType { String } eg: alert-success, alert-danger 
 */
function showSubscriptionResult(content, alertType) {
	$("#register .raw").addClass("subscription-height");
	var t1 = "<div class='alert " + alertType + " alert-dismissible' role='alert'>";
	var t2 = "<button type='button' class='close tf10' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>&times;</span></button>";
    var t3 = "<strong>" + content + "</strong></div>";
	var t = t1 + t2 + t3;
	$("#dialog").append(t);
	setTimeout(() => {
		$(".close").click();
		$(".raw").removeClass("subscription-height")
	}, 3000);
}
</script>
{% endblock %}
